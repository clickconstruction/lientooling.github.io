<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Final Demand Letter for Payment</title>
    <link rel="icon" href="favicon.svg" type="image/svg+xml">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <style>
        @media print {
            .no-print {
                display: none !important;
            }
        }
        .signature-line {
            border-bottom: 1px solid #000;
            width: 200px;
            margin-bottom: 5px;
        }
        #print-section {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1 class="text-center mb-2 no-print">Lien Tooling</h1>
        <div class="d-flex justify-content-center mb-4 no-print">
            <nav class="nav nav-pills">
                <a class="nav-link" href="index.html">Home</a>
                <a class="nav-link active" href="demand-letter.html">Demand Letter</a>
                <a class="nav-link" href="mechanics-lien.html">Mechanic's Lien</a>
                <a class="nav-link" href="release-lien.html">Release of Lien</a>
                <a class="nav-link" href="rules-for-texas.html">Rules for Texas</a>
            </nav>
        </div>
        
        <div id="form-section">
            <h2 class="text-center mb-4">Final Demand Letter for Payment</h2>
            
            <div class="d-grid gap-2 d-md-flex justify-content-md-end mb-3">
                <button type="button" id="test-data-btn" class="btn btn-secondary">Fill Test Data</button>
            </div>
            
            <form id="demand-letter-form" class="needs-validation" novalidate>
                <!-- Business Information -->
                <div class="card mb-4">
                    <div class="card-body">
                        <h4>Your Business Information</h4>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Business Name</label>
                                <input type="text" class="form-control" name="business-name" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Your Name</label>
                                <input type="text" class="form-control" name="sender-name" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Business Address</label>
                                <input type="text" class="form-control" name="business-address" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Business City</label>
                                <input type="text" class="form-control" name="business-city" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Business State</label>
                                <input type="text" class="form-control" name="business-state" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Business ZIP</label>
                                <input type="text" class="form-control" name="business-zip" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Business Phone</label>
                                <input type="text" class="form-control" name="business-phone" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Business Email</label>
                                <input type="email" class="form-control" name="business-email" required>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Client Information -->
                <div class="card mb-4">
                    <div class="card-body">
                        <h4>Client Information</h4>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Client Name</label>
                                <input type="text" class="form-control" name="client-name" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Client Address</label>
                                <input type="text" class="form-control" name="client-address" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Client City</label>
                                <input type="text" class="form-control" name="client-city" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Client State</label>
                                <input type="text" class="form-control" name="client-state" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Client ZIP</label>
                                <input type="text" class="form-control" name="client-zip" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Client County</label>
                                <input type="text" class="form-control" name="client-county" required>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Invoice Information -->
                <div class="card mb-4">
                    <div class="card-body">
                        <h4>Invoice Information</h4>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Invoice Number</label>
                                <input type="text" class="form-control" name="invoice-number" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Invoice Date</label>
                                <input type="date" class="form-control" name="invoice-date" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Due Date</label>
                                <input type="date" class="form-control" name="due-date" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Payment Deadline</label>
                                <input type="date" class="form-control" name="payment-deadline" required>
                            </div>
                            <div class="col-md-12 mb-3">
                                <label class="form-label">Service Description</label>
                                <textarea class="form-control" name="service-description" rows="3" required></textarea>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Service Dates</label>
                                <input type="text" class="form-control" name="service-dates" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Completion Date</label>
                                <input type="date" class="form-control" name="completion-date" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Invoice Total ($)</label>
                                <input type="number" class="form-control" name="invoice-total" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Payments Received ($)</label>
                                <input type="number" class="form-control" name="payments-received" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Outstanding Balance ($)</label>
                                <input type="number" class="form-control" name="outstanding-balance" required>
                            </div>
                            <div class="col-md-12 mb-3">
                                <label class="form-label">Payment Method Instructions</label>
                                <textarea class="form-control" name="payment-method" rows="3" required>Payment can be made by bank transfer to [Your Business Name] [Your Business Address], Routing: [Routing Number], Checking: [Account Number].</textarea>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Additional Options -->
                <div class="card mb-4">
                    <div class="card-body">
                        <h4>Additional Options</h4>
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" name="include-late-fees" id="include-late-fees">
                            <label class="form-check-label" for="include-late-fees">
                                Include Late Fee Language
                            </label>
                        </div>
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" name="include-notarial" id="include-notarial">
                            <label class="form-check-label" for="include-notarial">
                                Include Notarial Language
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                    <button type="button" id="generate-btn" class="btn btn-primary">Generate PDF</button>
                </div>
            </form>
        </div>
        
        <!-- Print Section -->
        <div id="print-section">
            <div class="no-print mb-4">
                <div class="d-flex justify-content-between align-items-center">
                    <h3>Print Preview</h3>
                    <div>
                        <button class="btn btn-secondary me-2" id="back-btn">Back to Edit</button>
                        <button class="btn btn-primary" id="print-btn">Print Document</button>
                    </div>
                </div>
            </div>
            
            <div id="letter-content" class="border p-4"></div>
        </div>
    </div>
    
    <script>
        // Test data for the demand letter form
        const demandLetterTestData = {
            'business-name': 'Click Plumbing LLC',
            'sender-name': 'Malachi Whites, Owner',
            'business-address': '5501 Balcones Dr A141',
            'business-city': 'Austin',
            'business-state': 'Texas',
            'business-zip': '78731',
            'business-phone': '(512) 555-1234',
            'business-email': 'malachi@clickplumbing.com',
            'client-name': 'Alice Johnson',
            'client-address': '456 Development Ave',
            'client-city': 'Austin',
            'client-state': 'Texas',
            'client-zip': '78702',
            'client-county': 'Travis',
            'invoice-number': 'INV-2025-0456',
            'invoice-date': '2025-04-15',
            'due-date': '2025-04-30',
            'payment-deadline': '2025-05-25',
            'service-description': 'Complete renovation of kitchen including cabinets, countertops, electrical, and plumbing work',
            'service-dates': 'January 15 - April 15, 2025',
            'completion-date': '2025-04-15',
            'invoice-total': '25000',
            'payments-received': '0',
            'outstanding-balance': '25000',
            'payment-method': 'Payment can be made by bank transfer to Click Plumbing LLC 5501 Balcones Dr A141 Austin TX 78731, Routing: 091311229, Checking: 202511226605.'
        };
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded');
            
            // Get elements
            const formSection = document.getElementById('form-section');
            const printSection = document.getElementById('print-section');
            const letterContent = document.getElementById('letter-content');
            const form = document.getElementById('demand-letter-form');
            const generateBtn = document.getElementById('generate-btn');
            const backBtn = document.getElementById('back-btn');
            const printBtn = document.getElementById('print-btn');
            const testDataBtn = document.getElementById('test-data-btn');
            
            console.log('Form section:', formSection);
            console.log('Print section:', printSection);
            console.log('Generate button:', generateBtn);
            
            // Fill test data button
            testDataBtn.addEventListener('click', function() {
                console.log('Fill test data clicked');
                
                Object.keys(demandLetterTestData).forEach(key => {
                    const input = form.querySelector(`[name="${key}"]`);
                    if (input) {
                        input.value = demandLetterTestData[key];
                    }
                });
                
                // Check the checkboxes
                document.getElementById('include-late-fees').checked = true;
                document.getElementById('include-notarial').checked = true;
            });
            
            // Generate PDF button
            generateBtn.addEventListener('click', function() {
                console.log('Generate button clicked');
                
                if (!form.checkValidity()) {
                    form.classList.add('was-validated');
                    return;
                }
                
                // Get form data
                const formData = new FormData(form);
                const formValues = {};
                formData.forEach((value, key) => {
                    formValues[key] = value;
                });
                
                // Format dates
                const invoiceDate = new Date(formValues['invoice-date']);
                const dueDate = new Date(formValues['due-date']);
                const paymentDeadline = new Date(formValues['payment-deadline']);
                const completionDate = new Date(formValues['completion-date']);
                
                const formatDate = (date) => {
                    return date.toLocaleDateString('en-US', { 
                        year: 'numeric', 
                        month: 'long', 
                        day: 'numeric' 
                    });
                };
                
                // Create letter content
                letterContent.innerHTML = `
                    <div style="padding: 20px; max-width: 800px; margin: 0 auto;">
                        <div style="text-align: right; margin-bottom: 2em;">
                            ${formatDate(new Date())}
                        </div>
                        
                        <div style="margin-bottom: 2em;">
                            <strong>TO:</strong> ${formValues['client-name']}<br>
                            ${formValues['client-address']}<br>
                            ${formValues['client-city']}, ${formValues['client-state']} ${formValues['client-zip']}
                        </div>
                        
                        <div style="margin-bottom: 2em;">
                            <strong>Re: Final Demand for Payment - Invoice #${formValues['invoice-number']}</strong>
                        </div>
                        
                        <div style="margin-bottom: 1em;">
                            Dear ${formValues['client-name']},
                        </div>
                        
                        <div style="margin-bottom: 1em; text-align: justify;">
                            This letter serves as a final formal demand for payment in the amount of <strong>$${parseFloat(formValues['outstanding-balance']).toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</strong> 
                            for services rendered. Our records indicate that Invoice #${formValues['invoice-number']} dated ${formatDate(invoiceDate)} 
                            remains unpaid despite the payment due date of ${formatDate(dueDate)}.
                        </div>
                        
                        <div style="margin-bottom: 1em; text-align: justify;">
                            The services provided included: ${formValues['service-description']}. These services were performed during ${formValues['service-dates']} 
                            and were completed on ${formatDate(completionDate)}.
                        </div>
                        
                        <div style="margin-bottom: 1em; text-align: justify;">
                            The total invoice amount was $${parseFloat(formValues['invoice-total']).toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}, 
                            of which $${parseFloat(formValues['payments-received']).toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})} has been paid, 
                            leaving an outstanding balance of $${parseFloat(formValues['outstanding-balance']).toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}.
                        </div>
                        
                        ${document.getElementById('include-late-fees').checked ? `
                        <div style="margin-bottom: 1em; text-align: justify;">
                            Please note that according to our agreement, late fees may be applied to overdue balances. These fees will continue to accrue until payment is received in full.
                        </div>
                        ` : ''}
                        
                        <div style="margin-bottom: 1em; text-align: justify;">
                            Please remit payment in full by <strong>${formatDate(paymentDeadline)}</strong>. ${formValues['payment-method']}
                        </div>
                        
                        <div style="margin-bottom: 2em; text-align: justify;">
                            If you dispute this debt or any portion thereof, you must notify us within 30 days of receiving this letter. Otherwise, we will assume the debt is valid.
                        </div>
                        
                        <div style="margin-bottom: 2em; text-align: justify;">
                            If payment is not received by the date specified above, we reserve the right to pursue all legal remedies available, including filing a mechanic's lien and/or initiating legal proceedings to recover the amount owed plus any additional costs incurred in the collection process.
                        </div>
                        
                        <div style="margin-top: 3em;">
                            Sincerely,
                            <div style="margin-top: 2em;">
                                <div class="signature-line"></div>
                                <strong>${formValues['sender-name']}</strong><br>
                                ${formValues['business-name']}<br>
                                ${formValues['business-phone']}<br>
                                ${formValues['business-email']}
                            </div>
                        </div>
                        
                        ${document.getElementById('include-notarial').checked ? `
                        <div style="margin-top: 4em; border-top: 1px solid #ccc; padding-top: 1em;">
                            <p>STATE OF TEXAS<br>
                            COUNTY OF ${formValues['client-county'].toUpperCase()}</p>
                            
                            <p>SWORN TO AND SUBSCRIBED BEFORE ME on this _____ day of _____________, ${new Date().getFullYear()}, by ${formValues['sender-name']}.</p>
                            
                            <div style="margin-top: 2em;">
                                ________________________________<br>
                                Notary Public, State of Texas
                            </div>
                        </div>
                        ` : ''}
                    </div>
                `;
                
                // Show print view and hide form
                formSection.style.display = 'none';
                printSection.style.display = 'block';
                
                console.log('Print section display:', printSection.style.display);
                console.log('Form section display:', formSection.style.display);
            });
            
            // Back button
            backBtn.addEventListener('click', function() {
                console.log('Back button clicked');
                printSection.style.display = 'none';
                formSection.style.display = 'block';
            });
            
            // Print button
            printBtn.addEventListener('click', function() {
                console.log('Print button clicked');
                window.print();
            });
        });
    </script>
</body>
</html>
